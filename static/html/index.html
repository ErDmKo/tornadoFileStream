<html>
    <head>
        <title>Simple stream App</title>
    </head>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <body>
        <h1>Download file <span id="response"></span></h1>
        <form action="/tornado/upload/" enctype="multipart/form-data" id="file_form" method="post">
            Select file to upload:
            <input multiple type="file" name="fileToUpload" id="fileToUpload">
            <input type="submit" value="Upload Image" name="submit">
        </form>
    </body>
    <script>
        var input = document.getElementById('fileToUpload'),
            statusInfo = document.getElementById("response"),
            loc = window.location, 
            new_uri="ws://" + loc.host+loc.pathname + 'tornado/ws/',
            ws = new WebSocket(new_uri);

        ws.onopen = function() {
             console.log('onopen');
        }; 
        ws.onclose = function() {
             console.log('close');
        }; 
        ws.onmessage = function(e) {
             console.log(e.data);
        }; 

        input.addEventListener("change", function (e) {
            var i = 0, len = this.files.length, img, reader, file;

            statusInfo.innerHTML = "Uploading . . .";
            for ( ; i < len; i++ ) {
                file = this.files[i];
                reader = new FileReader();
                reader.readAsDataURL(file);
                var formdata = new FormData();
                formdata.append("file", file);
                $.ajax({
                    url: document.getElementById("file_form").action,
                    type: "POST",
                    data: formdata,
                    processData: false,
                    contentType: false
                });
            }
        });
    </script>
</html>
